<!DOCTYPE html>
<html lang="zh"><head>
<title>数字系统实验报告——水位监测</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5, user-scalable=5" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="Verilog入门的蒟蒻~也是写上比较麻烦的项目了">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:url" content="https://www.zhaocloud.work/posts/bupt%E6%B0%B4%E4%BD%8D%E6%A3%80%E6%B5%8B%E5%AE%9E%E9%AA%8C/">
  <meta property="og:site_name" content="April Diary">
  <meta property="og:title" content="数字系统实验报告——水位监测">
  <meta property="og:description" content="Verilog入门的蒟蒻~也是写上比较麻烦的项目了">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-12-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-12-21T00:00:00+00:00">
    <meta property="article:tag" content="Verilog">












<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "pz9g1z5otp");
</script>



  




<link rel="icon" href="https://www.zhaocloud.work/favicon.ico">



      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css" integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>















<script>console.log("Hello from 'layouts/partials/extended_head.html'")</script>
<link rel='stylesheet' href='https://www.zhaocloud.work/fonts/result.css' />
<style>
  body {
    font-family: 'SDK_SC_Web', sans-serif;
  }
</style>

</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    时间线
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    归档
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    标签
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%95%b0%e5%ad%97%e7%b3%bb%e7%bb%9f%e8%ae%be%e8%ae%a1%e5%ae%9e%e9%aa%8c%e6%8a%a5%e5%91%8a%e6%b0%b4%e4%bd%8d%e7%9b%91%e6%b5%8b" class="nav-数字系统设计实验报告水位监测">
									数字系统设计实验报告——水位监测
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%ae%be%e8%ae%a1%e8%af%be%e9%a2%98%e7%9a%84%e4%bb%bb%e5%8a%a1%e8%a6%81%e6%b1%82" class="nav-设计课题的任务要求">
									设计课题的任务要求
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9f%ba%e6%9c%ac%e8%a6%81%e6%b1%82" class="nav-基本要求">
									基本要求
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%8f%90%e9%ab%98%e8%a6%81%e6%b1%82" class="nav-提高要求">
									提高要求
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a8%a1%e5%9d%97%e7%94%b5%e8%b7%af%e8%a6%81%e6%b1%82" class="nav-模块电路要求">
									模块电路要求
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%b3%bb%e7%bb%9f%e8%ae%be%e8%ae%a1" class="nav-系统设计">
									系统设计
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%ae%be%e8%ae%a1%e6%80%9d%e8%b7%af" class="nav-设计思路">
									设计思路
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%80%bb%e4%bd%93%e6%a1%86%e5%9b%be" class="nav-总体框图">
									总体框图
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e5%9d%97%e8%ae%be%e8%ae%a1" class="nav-分块设计">
									分块设计
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#verilog-hdl-%e4%bb%a3%e7%a0%81" class="nav-verilog-hdl-代码">
									Verilog HDL 代码
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#water_detectionv" class="nav-water_detectionv">
									water_detection.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#key_inputv" class="nav-key_inputv">
									key_input.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#kv_mapv" class="nav-kv_mapv">
									kv_map.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#div_clkv" class="nav-div_clkv">
									div_clk.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#select_dispv" class="nav-select_dispv">
									select_disp.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#segment7v" class="nav-segment7v">
									segment7.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#led_dispv" class="nav-led_dispv">
									led_disp.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#digi_screenv" class="nav-digi_screenv">
									digi_screen.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#led_matrixv" class="nav-led_matrixv">
									led_matrix.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#controllerv" class="nav-controllerv">
									controller.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#beepv" class="nav-beepv">
									beep.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#debouncev" class="nav-debouncev">
									debounce.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e4%bb%bf%e7%9c%9f%e6%b3%a2%e5%bd%a2%e5%8f%8a%e6%b3%a2%e5%bd%a2%e5%88%86%e6%9e%90" class="nav-仿真波形及波形分析">
									仿真波形及波形分析
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#beepv%e4%bb%bf%e7%9c%9f%e6%b3%a2%e5%bd%a2" class="nav-beepv仿真波形">
									beep.v 仿真波形
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#key_inputv%e4%bb%bf%e7%9c%9f%e6%b3%a2%e5%bd%a2" class="nav-key_inputv仿真波形">
									key_input.v仿真波形
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#led_matrixv%e4%bb%bf%e7%9c%9f%e6%b3%a2%e5%bd%a2" class="nav-led_matrixv仿真波形">
									led_matrix.v 仿真波形
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%8a%9f%e8%83%bd%e8%af%b4%e6%98%8e%e5%8f%8a%e8%b5%84%e6%ba%90%e5%88%a9%e7%94%a8%e6%83%85%e5%86%b5" class="nav-功能说明及资源利用情况">
									功能说明及资源利用情况
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%9e%e7%8e%b0%e7%9a%84%e5%8a%9f%e8%83%bd" class="nav-实现的功能">
									实现的功能
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%b5%84%e6%ba%90%e5%88%a9%e7%94%a8%e6%83%85%e5%86%b5" class="nav-资源利用情况">
									资源利用情况
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bc%96%e8%af%91%e7%bb%93%e6%9e%9c" class="nav-编译结果">
									编译结果
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%b5%84%e6%ba%90%e5%88%a9%e7%94%a8%e6%83%85%e5%86%b5-1" class="nav-资源利用情况-1">
									资源利用情况
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%95%85%e9%9a%9c%e5%8f%8a%e9%97%ae%e9%a2%98%e5%88%86%e6%9e%90" class="nav-故障及问题分析">
									故障及问题分析
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#1-%e6%8c%89%e9%94%ae%e8%be%93%e5%85%a5%e6%95%85%e9%9a%9c" class="nav-1-按键输入故障">
									1. 按键输入故障
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2-%e6%95%b0%e7%a0%81%e7%ae%a1%e6%98%be%e7%a4%ba%e9%94%99%e8%af%af" class="nav-2-数码管显示错误">
									2. 数码管显示错误
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#4-%e6%b0%b4%e4%bd%8d%e7%9b%91%e6%b5%8b%e9%80%bb%e8%be%91%e9%94%99%e8%af%af" class="nav-4-水位监测逻辑错误">
									4. 水位监测逻辑错误
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#7-%e8%b5%84%e6%ba%90%e5%88%a9%e7%94%a8%e4%b8%8d%e8%b6%b3%e6%88%96%e6%b5%aa%e8%b4%b9" class="nav-7-资源利用不足或浪费">
									7. 资源利用不足或浪费
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%80%bb%e7%bb%93%e5%92%8c%e7%bb%93%e8%ae%ba" class="nav-总结和结论">
									总结和结论
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://www.zhaocloud.work/">
            April Diary
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://www.zhaocloud.work/">
        <div class="single-column-header-title">April Diary</div>
        
        <div class="single-column-header-subtitle">人间四月芳菲尽</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    数字系统实验报告——水位监测
                    
                    <div class="post-subtitle">
                        Verilog入门的蒟蒻~也是写上比较麻烦的项目了
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2024-12-21 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/%E7%BC%96%E7%A8%8B">编程</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/verilog">Verilog</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="数字系统设计实验报告水位监测">数字系统设计实验报告——水位监测</h1>
<h2 id="设计课题的任务要求">设计课题的任务要求</h2>
<p>模拟一个水位监测系统，通过控制点阵、数码管等显示水位信息，当水位超出范围时进行报警，具体情况和系统功能要求如下：</p>
<h3 id="基本要求">基本要求</h3>
<ol>
<li>
<p>通过<code>SW4~SW0</code>的值来确定当前水位，其中<code>SW4~SW1</code>表示整数位，<code>SW0</code>表示小数位，<code>0~6</code>米（含）为安全水位，<code>6~12</code>米（含）为警惕水位，<code>12</code>米以上为危险水位。</p>
</li>
<li>
<p>用数码管<code>DISP2~DISP0</code>显示水位数值，显示到小数点后<code>1</code>位。</p>
</li>
<li>
<p>用点阵显示水位变化示意图：当水位低于等于<code>6</code>米时，点阵最下面<code>2</code>行显示全绿；当水位在“警惕水位”时，点阵显示黄色，<code>6~8</code>米（含）时，亮下面<code>3</code>行，<code>8~10</code>米（含）时，亮下面<code>4</code>行，<code>10~12</code>米（含）时，亮下面<code>5</code>行；当水位在“危险水位”，点阵显示红色，<code>12~13</code>米（含）时，亮下面<code>6</code>行，<code>13~14</code>米（含）时，亮下面<code>7</code>行，<code>14</code>米以上时，点阵全亮，且以<code>2Hz</code>的频率闪烁。</p>
</li>
<li>
<p>水位处于“警惕水位”或“危险水位”时，蜂鸣器发出报警声，报警声音的音调随水位增高而增高。</p>
</li>
<li>
<p>水位处于“危险水位”时，按<code>BTN0</code>启动点阵动画模拟水泵抽水，抽水动画自行设计，直至水位降至“安全水位”，点阵恢复显示水位变化。</p>
</li>
<li>
<p>水泵抽水速度“慢”、“中”、“快”三档可调，在数码管<code>DISP7</code>上分别显示<code>1</code>、<code>2</code>、<code>3</code>表示三种速度，通过<code>BTN7</code>按键进行循环切换，不同速度时抽水动画的变化速度也同步进行变化。</p>
</li>
</ol>
<h3 id="提高要求">提高要求</h3>
<ol>
<li>
<p>水位值可通过<code>4x4</code>键盘输入。</p>
</li>
<li>
<p>自拟其他功能。</p>
</li>
</ol>
<h3 id="模块电路要求">模块电路要求</h3>
<p>在<code>8x8</code>双色点阵上设计并实现水泵抽水的动画显示，动画图案自行设计，要求完成仿真并在实验板上下载显示。</p>
<h2 id="系统设计">系统设计</h2>
<h3 id="设计思路">设计思路</h3>
<p>以功能要求作为模块区分的参考，同时针对开发板的实际硬件区分和功能实现，我对整个程序进行了以下的模块拆分：</p>
<table>
  <thead>
      <tr>
          <th>water_detection</th>
          <th>key_input</th>
          <th>kv_map</th>
          <th>beep</th>
          <th>div_clk</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>主模块</td>
          <td>按键输入模块</td>
          <td>按键功能映射模块</td>
          <td>蜂鸣器模块</td>
          <td>分频器模块</td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>debounce</th>
          <th>digi_screen</th>
          <th>controller</th>
          <th>led_disp</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>按键消抖模块</td>
          <td>HEX到LED点阵译码模块</td>
          <td>LED点阵控制模块</td>
          <td>数码管控制模块</td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>segment7</th>
          <th>select_disp</th>
          <th>led_matrix</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>数码管译码模块（包含小数点）</td>
          <td>数码管选位信号模块</td>
          <td>LED点阵动画显示模块</td>
      </tr>
  </tbody>
</table>
<h3 id="总体框图">总体框图</h3>
<p><img src="assets/ce531aa45de17f117ddd2fd85dc81e13e4232c5e.png" alt="export.png"></p>
<h3 id="分块设计">分块设计</h3>
<ul>
<li>
<p><code>water_detection</code>：顶层模块，负责将所有模块实例化。</p>
</li>
<li>
<p><code>key_input</code>：IO，读取按键输入、消抖，并转成对应的脉冲信号</p>
</li>
<li>
<p><code>kv_map</code>：Key-Value模块，将<code>key_input</code>的输入转成对应的指令进行控制，使输入的拓展性大大增加。</p>
</li>
<li>
<p><code>beep</code>：IO，根据传入的状态调节音调。</p>
</li>
<li>
<p><code>div_clk</code>：基本模块，可以对系统时钟进行分频，支持修改参数。</p>
</li>
<li>
<p><code>debounce</code>：基本模块，用于单个按钮的消抖。</p>
</li>
<li>
<p><code>digi_screen</code>：基本模块，用于将HEX转成LED矩阵数据。</p>
</li>
<li>
<p><code>controller</code>：控制器，可以将输入的8421BCD码数字转成二进制数并比较，得到当前的水位状态。</p>
</li>
<li>
<p><code>led_disp</code>：IO，负责数码管的相关显示。</p>
</li>
<li>
<p><code>segment7</code>：译码器，实现8421BCD码到人类可读数码管的译码。</p>
</li>
<li>
<p><code>select_disp</code>：脉冲分配器，用于生成数码管的选位信号。</p>
</li>
<li>
<p><code>led_matrix</code>：IO，负责LED点阵的相关显示。</p>
</li>
</ul>
<h2 id="verilog-hdl-代码">Verilog HDL 代码</h2>
<h3 id="water_detectionv"><code>water_detection.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// water_detection.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> water_detection(
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> <span style="color:#9aedfe">wire</span> clk,       <span style="color:#78787e">// 系统时钟
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> btn7,           <span style="color:#78787e">// 水泵挡位
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> btn0,           <span style="color:#78787e">// 水泵开关
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] row_in,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] col,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">6</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] segment7, <span style="color:#78787e">// 数码管信号
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] row,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] green_led,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] red_led,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] select, <span style="color:#78787e">// 数码管选位信号
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">output</span> beep,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> dp            <span style="color:#78787e">// 小数点信号
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>);
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">wire</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] key;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">wire</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] value;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">wire</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] number;      <span style="color:#78787e">// 整数部分
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#9aedfe">wire</span> [<span style="color:#ff9f43">2</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] state;       <span style="color:#78787e">// 水位状态
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#9aedfe">wire</span> [<span style="color:#ff9f43">1</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] Anime_state; <span style="color:#78787e">// 水泵状态
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#9aedfe">wire</span> beeper;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">// 模块实例化部分，具体内容参考后续代码
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>key_input key_input1(
</span></span><span style="display:flex;"><span>    .clk(clk),
</span></span><span style="display:flex;"><span>    .row(row_in),
</span></span><span style="display:flex;"><span>    .col(col),
</span></span><span style="display:flex;"><span>    .key(key)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>kv_map kv_map1(
</span></span><span style="display:flex;"><span>    .key(key),
</span></span><span style="display:flex;"><span>    .value(value)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>led_disp led_disp1(
</span></span><span style="display:flex;"><span>    .clk(clk),
</span></span><span style="display:flex;"><span>    .key(value),
</span></span><span style="display:flex;"><span>    .select(select),
</span></span><span style="display:flex;"><span>    .segment7x(segment7),
</span></span><span style="display:flex;"><span>    .number_out(number),
</span></span><span style="display:flex;"><span>    .dp(dp),
</span></span><span style="display:flex;"><span>    .Anime_state(Anime_state),
</span></span><span style="display:flex;"><span>    .state(state)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>controller controller1(
</span></span><span style="display:flex;"><span>    .clk(clk),
</span></span><span style="display:flex;"><span>    .number(number),
</span></span><span style="display:flex;"><span>    .btn0(btn0),
</span></span><span style="display:flex;"><span>    .state(state)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>led_matrix led_matrix1(
</span></span><span style="display:flex;"><span>    .clk(clk),
</span></span><span style="display:flex;"><span>    .state(state),
</span></span><span style="display:flex;"><span>    .btn7(btn7),
</span></span><span style="display:flex;"><span>    .red_led(red_led),
</span></span><span style="display:flex;"><span>    .green_led(green_led),
</span></span><span style="display:flex;"><span>    .row(row),
</span></span><span style="display:flex;"><span>    .beeper(beeper),
</span></span><span style="display:flex;"><span>    .Anime_state(Anime_state)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>beep beep1(
</span></span><span style="display:flex;"><span>    .clk(clk),
</span></span><span style="display:flex;"><span>    .beep_en(beeper),
</span></span><span style="display:flex;"><span>    .state(state),
</span></span><span style="display:flex;"><span>    .beep_out(beep)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span>
</span></span></code></pre></div><h3 id="key_inputv"><code>key_input.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// key_input.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> key_input(
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> <span style="color:#9aedfe">wire</span> clk,      <span style="color:#78787e">//1khz
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> <span style="color:#9aedfe">wire</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] row,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] col,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] key <span style="color:#78787e">//已经消抖并且产生一周期信号的脉冲，默认空信号为1111
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>);
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] key_unconfirmed;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">31</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] counter;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] key_pre;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">initial</span> <span style="color:#ff6ac1">begin</span> 
</span></span><span style="display:flex;"><span>    col <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1110</span>;
</span></span><span style="display:flex;"><span>    counter <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>    key_pre <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>;
</span></span><span style="display:flex;"><span>    key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>;
</span></span><span style="display:flex;"><span>    key <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">// 选位信号发生器
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">always</span> @(<span style="color:#ff6ac1">negedge</span> clk) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>    col <span style="color:#ff6ac1">&lt;=</span> {col[<span style="color:#ff9f43">2</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>],col[<span style="color:#ff9f43">3</span>]}; 
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">// 同步检测
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">always</span> @(<span style="color:#ff6ac1">posedge</span> clk) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">case</span>(row)
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1110</span><span style="color:#ff6ac1">:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">case</span>(col)
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1110</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0000</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1101</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0001</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1011</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0010</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0111</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0011</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1101</span><span style="color:#ff6ac1">:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">case</span>(col)
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1110</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0100</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1101</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0101</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1011</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0110</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0111</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0111</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1011</span><span style="color:#ff6ac1">:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">case</span>(col)
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1110</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1000</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1101</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1001</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1011</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1010</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0111</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1011</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0111</span><span style="color:#ff6ac1">:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">case</span>(col)
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1110</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1100</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1101</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1101</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1011</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1110</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0111</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">default</span><span style="color:#ff6ac1">:</span> key_unconfirmed <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">// 消抖
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">always</span>@(<span style="color:#ff6ac1">negedge</span> clk) <span style="color:#ff6ac1">begin</span> <span style="color:#78787e">// 每次在下降沿检测
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">if</span> (key_unconfirmed <span style="color:#ff6ac1">!=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">if</span> (key_pre <span style="color:#ff6ac1">==</span> key_unconfirmed) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">if</span> (counter <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">60</span>) <span style="color:#ff6ac1">begin</span> <span style="color:#78787e">// 检测到连续不断的60次key才认可这次输入
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>                key <span style="color:#ff6ac1">=</span> key_unconfirmed;
</span></span><span style="display:flex;"><span>                counter <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                counter <span style="color:#ff6ac1">=</span> counter <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            counter <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>            key_pre <span style="color:#ff6ac1">=</span> key_unconfirmed;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        key <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span> 
</span></span></code></pre></div><h3 id="kv_mapv"><code>kv_map.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// kv_map.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> kv_map(
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] key,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] value  <span style="color:#78787e">//将4*4的键盘映射到8421BCD码&amp;点和清零
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>);
</span></span><span style="display:flex;"><span><span style="color:#78787e">// 代码简单，主要是提高可读性和可拓展性
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">always</span> @(<span style="color:#ff6ac1">*</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">case</span>(key)
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0000</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0000</span>; <span style="color:#78787e">//0
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1100</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0001</span>; <span style="color:#78787e">//1
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1101</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0010</span>; <span style="color:#78787e">//2
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1110</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0011</span>; <span style="color:#78787e">//3
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1000</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0100</span>; <span style="color:#78787e">//4
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1001</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0101</span>; <span style="color:#78787e">//5
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1010</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0110</span>; <span style="color:#78787e">//6
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0100</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0111</span>; <span style="color:#78787e">//7
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0101</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1000</span>; <span style="color:#78787e">//8
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0110</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1001</span>; <span style="color:#78787e">//9
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0001</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1010</span>; <span style="color:#78787e">//dot
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0010</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1011</span>; <span style="color:#78787e">//reset
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff6ac1">default</span><span style="color:#ff6ac1">:</span> value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span>
</span></span></code></pre></div><h3 id="div_clkv"><code>div_clk.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// div_clk.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> div_clk #(
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">parameter</span> DIVISOR <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">100</span> <span style="color:#78787e">// 默认100
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>)(
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> <span style="color:#9aedfe">wire</span> clk_in,      <span style="color:#78787e">// 系统时钟
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> <span style="color:#9aedfe">wire</span> rst,         <span style="color:#78787e">// 复位
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> clk_out      <span style="color:#78787e">// 输出分频结果
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">9</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] counter;     <span style="color:#78787e">// 计数器，最高支持分频2^10
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">initial</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        clk_out <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>        counter <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">always</span> @(<span style="color:#ff6ac1">negedge</span> clk_in <span style="color:#ff6ac1">or</span> <span style="color:#ff6ac1">posedge</span> rst) <span style="color:#ff6ac1">begin</span> <span style="color:#78787e">// 异步复位
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        <span style="color:#ff6ac1">if</span> (rst) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            counter <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>            clk_out <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">if</span> (counter <span style="color:#ff6ac1">==</span> (DIVISOR<span style="color:#ff6ac1">/</span><span style="color:#ff9f43">2</span> <span style="color:#ff6ac1">-</span> <span style="color:#ff9f43">1</span>)) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                clk_out <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff6ac1">~</span>clk_out;
</span></span><span style="display:flex;"><span>                counter <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                counter <span style="color:#ff6ac1">&lt;=</span> counter <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span>
</span></span></code></pre></div><h3 id="select_dispv"><code>select_disp.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// select_disp.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> select_disp (    <span style="color:#78787e">//选位信号
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> <span style="color:#9aedfe">wire</span> clk,       <span style="color:#78787e">// 输入时钟
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> <span style="color:#9aedfe">wire</span> rst_n,     <span style="color:#78787e">// 低电平有效的复位
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] out  <span style="color:#78787e">// 4位输出（适应于这次的实验）
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">initial</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>    out <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0111</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">always</span> @(<span style="color:#ff6ac1">posedge</span> clk) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">if</span> (<span style="color:#ff6ac1">!</span>rst_n) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        out <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0111</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        out <span style="color:#ff6ac1">&lt;=</span> {out[<span style="color:#ff9f43">2</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>], out[<span style="color:#ff9f43">3</span>]}; <span style="color:#78787e">// 左移一位
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span>
</span></span></code></pre></div><h3 id="segment7v"><code>segment7.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// segment7.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> segment7(
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] num,       <span style="color:#78787e">// 四位输入信号
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> dp_in,           <span style="color:#78787e">// 小数点
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">6</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] seg7, <span style="color:#78787e">// 数码管信号
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> dp
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">always</span> @(num) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">case</span>(num)
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0000</span><span style="color:#ff6ac1">:</span>seg7<span style="color:#ff6ac1">=</span><span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b1111110</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0001</span><span style="color:#ff6ac1">:</span>seg7<span style="color:#ff6ac1">=</span><span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b0110000</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0010</span><span style="color:#ff6ac1">:</span>seg7<span style="color:#ff6ac1">=</span><span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b1101101</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0011</span><span style="color:#ff6ac1">:</span>seg7<span style="color:#ff6ac1">=</span><span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b1111001</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0100</span><span style="color:#ff6ac1">:</span>seg7<span style="color:#ff6ac1">=</span><span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b0110011</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0101</span><span style="color:#ff6ac1">:</span>seg7<span style="color:#ff6ac1">=</span><span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b1011011</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0110</span><span style="color:#ff6ac1">:</span>seg7<span style="color:#ff6ac1">=</span><span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b1011111</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0111</span><span style="color:#ff6ac1">:</span>seg7<span style="color:#ff6ac1">=</span><span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b1110000</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1000</span><span style="color:#ff6ac1">:</span>seg7<span style="color:#ff6ac1">=</span><span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b1111111</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1001</span><span style="color:#ff6ac1">:</span>seg7<span style="color:#ff6ac1">=</span><span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b1111011</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">default</span><span style="color:#ff6ac1">:</span>seg7<span style="color:#ff6ac1">=</span><span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b0000001</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">always</span> @(dp_in) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        dp <span style="color:#ff6ac1">=</span> dp_in;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span>
</span></span></code></pre></div><h3 id="led_dispv"><code>led_disp.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// led_disp.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> led_disp(
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> clk,            <span style="color:#78787e">// 系统时钟
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] key,      <span style="color:#78787e">// 输入指令脉冲
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] select,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">6</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] segment7x,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] number_out, <span style="color:#78787e">// 用户输入的结果
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">output</span> dp,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> [<span style="color:#ff9f43">1</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] Anime_state, <span style="color:#78787e">// 动画状态，和下方的state共同控制风扇转速显示
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] state
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] num;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">11</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] number;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> dp_in;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">wire</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] select_n;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">initial</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        number <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">12&#39;hfff</span>;
</span></span><span style="display:flex;"><span>        num <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0000</span>;
</span></span><span style="display:flex;"><span>        dp_in <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">always</span> @(<span style="color:#ff6ac1">negedge</span> clk) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">if</span> (key <span style="color:#ff6ac1">!=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">if</span> (key <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1011</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                number <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">12&#39;hfff</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                number <span style="color:#ff6ac1">=</span> {number[<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>],key}; <span style="color:#78787e">// 将用户输入储存下来，并移位
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>    select_disp slct(  <span style="color:#78787e">// 实例化选位信号
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        .clk(clk),
</span></span><span style="display:flex;"><span>        .rst_n(<span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>),
</span></span><span style="display:flex;"><span>        .out(select_n)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    segment7 decoder(  <span style="color:#78787e">// 实例化译码器
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        .dp_in(dp_in),
</span></span><span style="display:flex;"><span>        .num(num),
</span></span><span style="display:flex;"><span>        .seg7(segment7x),
</span></span><span style="display:flex;"><span>        .dp(dp)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">assign</span> number_out <span style="color:#ff6ac1">=</span> number[<span style="color:#ff9f43">11</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">4</span>];                    <span style="color:#78787e">// 取整数部分
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">assign</span> select <span style="color:#ff6ac1">=</span> {select_n[<span style="color:#ff9f43">3</span>],<span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>,select_n[<span style="color:#ff9f43">2</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>]}; <span style="color:#78787e">// 选位信号生成
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">always</span>@(select_n) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">// select_n主要功能是显示对应数码管的数字，并将值传入数码管对应管脚
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        <span style="color:#ff6ac1">case</span>(select_n)
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1110</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            num <span style="color:#ff6ac1">&lt;=</span> number[<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>];
</span></span><span style="display:flex;"><span>            dp_in<span style="color:#ff6ac1">&lt;=</span><span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1101</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            num <span style="color:#ff6ac1">&lt;=</span> number[<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">4</span>];
</span></span><span style="display:flex;"><span>            dp_in<span style="color:#ff6ac1">&lt;=</span><span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1011</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            num <span style="color:#ff6ac1">&lt;=</span> number[<span style="color:#ff9f43">11</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">8</span>];
</span></span><span style="display:flex;"><span>            dp_in<span style="color:#ff6ac1">&lt;=</span><span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0111</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">if</span> (state <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b111</span>) <span style="color:#ff6ac1">begin</span> <span style="color:#78787e">// 要是水泵工作模式
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>                <span style="color:#ff6ac1">case</span>(Anime_state) <span style="color:#78787e">// 根据Anime_state 显示对应挡位
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>                <span style="color:#ff9f43">2</span><span style="color:#ff9f43">&#39;b00</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> num <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0001</span>; dp_in<span style="color:#ff6ac1">&lt;=</span><span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;<span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">2</span><span style="color:#ff9f43">&#39;b01</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> num <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0010</span>; dp_in<span style="color:#ff6ac1">&lt;=</span><span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;<span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">2</span><span style="color:#ff9f43">&#39;b10</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> num <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0011</span>; dp_in<span style="color:#ff6ac1">&lt;=</span><span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;<span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                num <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>;
</span></span><span style="display:flex;"><span>                dp_in<span style="color:#ff6ac1">&lt;=</span><span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">default</span><span style="color:#ff6ac1">:</span> <span style="color:#ff6ac1">begin</span> num <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>; dp_in<span style="color:#ff6ac1">&lt;=</span><span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;<span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span>
</span></span></code></pre></div><h3 id="digi_screenv"><code>digi_screen.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// digi_screen.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e">// https://xantorohara.github.io/led-matrix-editor
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> digi_screen
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> <span style="color:#9aedfe">wire</span> clk,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> [<span style="color:#ff9f43">63</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] PICTURE_G, <span style="color:#78787e">// 64*64 picture
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> [<span style="color:#ff9f43">63</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] PICTURE_R, <span style="color:#78787e">// 64*64 picture  
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] row,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] col_r,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] col_g
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">initial</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        row <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">8</span><span style="color:#ff9f43">&#39;b0111</span>_1111;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">always</span>@(<span style="color:#ff6ac1">negedge</span> clk) <span style="color:#ff6ac1">begin</span> <span style="color:#78787e">// 行扫描信号
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        row <span style="color:#ff6ac1">&lt;=</span> {row[<span style="color:#ff9f43">6</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>], row[<span style="color:#ff9f43">7</span>]};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">always</span>@(<span style="color:#ff6ac1">negedge</span> clk) <span style="color:#ff6ac1">begin</span> <span style="color:#78787e">//列信号，主要是对信号做分配
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        <span style="color:#ff6ac1">case</span>(row)
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">8</span><span style="color:#ff9f43">&#39;b1111</span><span style="color:#ff5c57">_1110:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            col_r <span style="color:#ff6ac1">&lt;=</span> PICTURE_R[<span style="color:#ff9f43">15</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">8</span>];
</span></span><span style="display:flex;"><span>            col_g <span style="color:#ff6ac1">&lt;=</span> PICTURE_G[<span style="color:#ff9f43">15</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">8</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">8</span><span style="color:#ff9f43">&#39;b1111</span><span style="color:#ff5c57">_1101:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            col_r <span style="color:#ff6ac1">&lt;=</span> PICTURE_R[<span style="color:#ff9f43">23</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">16</span>];
</span></span><span style="display:flex;"><span>            col_g <span style="color:#ff6ac1">&lt;=</span> PICTURE_G[<span style="color:#ff9f43">23</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">16</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">8</span><span style="color:#ff9f43">&#39;b1111</span><span style="color:#ff5c57">_1011:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            col_r <span style="color:#ff6ac1">&lt;=</span> PICTURE_R[<span style="color:#ff9f43">31</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">24</span>];
</span></span><span style="display:flex;"><span>            col_g <span style="color:#ff6ac1">&lt;=</span> PICTURE_G[<span style="color:#ff9f43">31</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">24</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">8</span><span style="color:#ff9f43">&#39;b1111</span><span style="color:#ff5c57">_0111:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            col_r <span style="color:#ff6ac1">&lt;=</span> PICTURE_R[<span style="color:#ff9f43">39</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">32</span>];
</span></span><span style="display:flex;"><span>            col_g <span style="color:#ff6ac1">&lt;=</span> PICTURE_G[<span style="color:#ff9f43">39</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">32</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">8</span><span style="color:#ff9f43">&#39;b1110</span><span style="color:#ff5c57">_1111:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            col_r <span style="color:#ff6ac1">&lt;=</span> PICTURE_R[<span style="color:#ff9f43">47</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">40</span>];
</span></span><span style="display:flex;"><span>            col_g <span style="color:#ff6ac1">&lt;=</span> PICTURE_G[<span style="color:#ff9f43">47</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">40</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">8</span><span style="color:#ff9f43">&#39;b1101</span><span style="color:#ff5c57">_1111:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            col_r <span style="color:#ff6ac1">&lt;=</span> PICTURE_R[<span style="color:#ff9f43">55</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">48</span>];
</span></span><span style="display:flex;"><span>            col_g <span style="color:#ff6ac1">&lt;=</span> PICTURE_G[<span style="color:#ff9f43">55</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">48</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">8</span><span style="color:#ff9f43">&#39;b1011</span><span style="color:#ff5c57">_1111:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            col_r <span style="color:#ff6ac1">&lt;=</span> PICTURE_R[<span style="color:#ff9f43">63</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">56</span>];
</span></span><span style="display:flex;"><span>            col_g <span style="color:#ff6ac1">&lt;=</span> PICTURE_G[<span style="color:#ff9f43">63</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">56</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff9f43">8</span><span style="color:#ff9f43">&#39;b0111</span><span style="color:#ff5c57">_1111:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            col_r <span style="color:#ff6ac1">&lt;=</span> PICTURE_R[<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>];
</span></span><span style="display:flex;"><span>            col_g <span style="color:#ff6ac1">&lt;=</span> PICTURE_G[<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">default</span><span style="color:#ff6ac1">:</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            col_r <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">8&#39;h00</span>;
</span></span><span style="display:flex;"><span>            col_g <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">8&#39;h00</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span>
</span></span></code></pre></div><h3 id="led_matrixv"><code>led_matrix.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// led_matrix.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> led_matrix(<span style="color:#78787e">//在8x8的led矩阵上显示动画，同时发出蜂鸣器声音，包含七个水位挡位，和一位按钮控制动画状态
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">input</span> clk,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> [<span style="color:#ff9f43">2</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] state,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> btn7,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] red_led,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] green_led,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] row,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> beeper,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">1</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] Anime_state
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">wire</span> clk_div_r2;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">wire</span> clk_low;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">wire</span> clk_middle;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">wire</span> clk_high;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">wire</span> key_pulse;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    div_clk #(         <span style="color:#78787e">// 水泵1挡
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        .DIVISOR(<span style="color:#ff9f43">1000</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    div_clk_low (
</span></span><span style="display:flex;"><span>        .clk_in(clk),
</span></span><span style="display:flex;"><span>        .rst(),
</span></span><span style="display:flex;"><span>        .clk_out(clk_low)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    debounce dbsa(         <span style="color:#78787e">// 按键消抖
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        .clk(clk),
</span></span><span style="display:flex;"><span>        .rst(),
</span></span><span style="display:flex;"><span>        .key(btn7),
</span></span><span style="display:flex;"><span>        .key_pulse(key_pulse)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    div_clk #(         <span style="color:#78787e">// 水泵2挡
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        .DIVISOR(<span style="color:#ff9f43">500</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    div_clk_mid (
</span></span><span style="display:flex;"><span>        .clk_in(clk),
</span></span><span style="display:flex;"><span>        .rst(),
</span></span><span style="display:flex;"><span>        .clk_out(clk_middle)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    div_clk #(         <span style="color:#78787e">// 水泵3挡
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        .DIVISOR(<span style="color:#ff9f43">250</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    div_clk_high (
</span></span><span style="display:flex;"><span>        .clk_in(clk),
</span></span><span style="display:flex;"><span>        .rst(),
</span></span><span style="display:flex;"><span>        .clk_out(clk_high)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    div_clk #(         <span style="color:#78787e">// 水泵动画2Hz分频
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        .DIVISOR(<span style="color:#ff9f43">500</span>)
</span></span><span style="display:flex;"><span>    ) div_clk_2Hz (
</span></span><span style="display:flex;"><span>        .clk_in(clk),
</span></span><span style="display:flex;"><span>        .rst(),
</span></span><span style="display:flex;"><span>        .clk_out(clk_div_r2)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">63</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] r_led;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">63</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] g_led;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">initial</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        beeper <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span>        Anime_state <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">2</span><span style="color:#ff9f43">&#39;b00</span>;
</span></span><span style="display:flex;"><span>        r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>        g_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">always</span>@(<span style="color:#ff6ac1">posedge</span> key_pulse) <span style="color:#ff6ac1">begin</span> <span style="color:#78787e">// 模3计数器，用于控制水泵速度
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        <span style="color:#ff6ac1">if</span> (Anime_state <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">2</span><span style="color:#ff9f43">&#39;b10</span>)
</span></span><span style="display:flex;"><span>            Anime_state <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">2</span><span style="color:#ff9f43">&#39;b00</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">else</span>
</span></span><span style="display:flex;"><span>            Anime_state <span style="color:#ff6ac1">=</span> Anime_state <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    digi_screen digi_screen_red ( <span style="color:#78787e">// 8*8LED点阵模块实例化
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        .PICTURE_G(g_led),
</span></span><span style="display:flex;"><span>        .PICTURE_R(r_led),
</span></span><span style="display:flex;"><span>        .clk(clk),
</span></span><span style="display:flex;"><span>        .row(row),
</span></span><span style="display:flex;"><span>        .col_r(red_led),
</span></span><span style="display:flex;"><span>        .col_g(green_led)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">always</span>@(<span style="color:#ff6ac1">negedge</span> clk)<span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">case</span>(state)
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b000</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;hffff000000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;h0000000000000000</span>; beeper <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;<span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b001</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;hffffff0000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;hffffff0000000000</span>; beeper <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;<span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b010</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;hffffffff00000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;hffffffff00000000</span>; beeper <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;<span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b011</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;hffffffffff000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;hffffffffff000000</span>; beeper <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;<span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b100</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;h0000000000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;hffffffffffff0000</span>; beeper <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;<span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b101</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;h0000000000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;hffffffffffffff00</span>; beeper <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;<span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b110</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> <span style="color:#78787e">// 动画设计
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>                <span style="color:#ff6ac1">case</span>(clk_div_r2)
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;h0000000000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;h0000000000000000</span>; <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;h0000000000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;hffffffffffffffff</span>; <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>                beeper <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b111</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">case</span>(Anime_state)
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">2</span><span style="color:#ff9f43">&#39;b00</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">case</span>(clk_low)
</span></span><span style="display:flex;"><span>                    <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;h0000000000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;ha4e4ffe4e4bf1e3f</span>; <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;h0000000000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;hb1eae4eaf1bf1e3f</span>; <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>                beeper <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">2</span><span style="color:#ff9f43">&#39;b01</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">case</span>(clk_middle)
</span></span><span style="display:flex;"><span>                    <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;h0000000000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;ha4e4ffe4e4bf1e3f</span>; <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;h0000000000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;hb1eae4eaf1bf1e3f</span>; <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>                beeper <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff9f43">2</span><span style="color:#ff9f43">&#39;b10</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">case</span>(clk_high)
</span></span><span style="display:flex;"><span>                    <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;h0000000000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;ha4e4ffe4e4bf1e3f</span>; <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span><span style="color:#ff6ac1">:</span><span style="color:#ff6ac1">begin</span> g_led <span style="color:#ff6ac1">=</span><span style="color:#ff9f43">64&#39;h0000000000000000</span>;r_led <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">64&#39;hb1eae4eaf1bf1e3f</span>; <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>                beeper <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>             <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">endcase</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>          
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span>
</span></span></code></pre></div><h3 id="controllerv"><code>controller.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// controller.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> controller(
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> <span style="color:#9aedfe">wire</span> clk,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> [<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] number,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> <span style="color:#9aedfe">wire</span> btn0,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">2</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] state
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">wire</span> key;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">6</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] integer_value;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> mode; <span style="color:#78787e">// 水泵工作状态
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">initial</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>    mode <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>    integer_value <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">7</span><span style="color:#ff9f43">&#39;b000</span>_0000;
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#78787e">// 处理按钮切换模式
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    debounce dbs (  <span style="color:#78787e">// 状态按钮消抖
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        .clk(clk),
</span></span><span style="display:flex;"><span>        .rst(<span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>),
</span></span><span style="display:flex;"><span>        .key(btn0),
</span></span><span style="display:flex;"><span>        .key_pulse(key)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">always</span>@(<span style="color:#ff6ac1">posedge</span> key) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        mode <span style="color:#ff6ac1">=~</span>mode;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#78787e">// 处理number和dp_list，计算state
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>    <span style="color:#ff6ac1">always</span> @(<span style="color:#ff6ac1">*</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        integer_value <span style="color:#ff6ac1">=</span>number[<span style="color:#ff9f43">7</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">4</span>] <span style="color:#ff6ac1">*</span> <span style="color:#ff9f43">10</span><span style="color:#ff6ac1">+</span>number[<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#78787e">// 根据模式设置state
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        <span style="color:#ff6ac1">if</span> (mode <span style="color:#ff6ac1">&amp;&amp;</span> integer_value <span style="color:#ff6ac1">&gt;=</span> <span style="color:#ff9f43">14</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            state <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b111</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">if</span> (integer_value <span style="color:#ff6ac1">&lt;</span> <span style="color:#ff9f43">6</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                state <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b000</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">if</span> (integer_value <span style="color:#ff6ac1">&lt;</span> <span style="color:#ff9f43">8</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                state <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b001</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">if</span> (integer_value <span style="color:#ff6ac1">&lt;</span> <span style="color:#ff9f43">10</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                state <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b010</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">if</span> (integer_value <span style="color:#ff6ac1">&lt;</span> <span style="color:#ff9f43">12</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                state <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b011</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">if</span> (integer_value <span style="color:#ff6ac1">&lt;</span> <span style="color:#ff9f43">13</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                state <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b100</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">if</span> (integer_value <span style="color:#ff6ac1">&lt;</span> <span style="color:#ff9f43">14</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                state <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b101</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>                state <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b110</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span>
</span></span></code></pre></div><h3 id="beepv"><code>beep.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// beep.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> beep(
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> clk,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> beep_en,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> [<span style="color:#ff9f43">2</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] state,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> beep_out
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#78787e">// 以下分频可以根据状态控制音调
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#9aedfe">wire</span> beep_out_state0,beep_out_state1,beep_out_state2,beep_out_state3,beep_out_state4,beep_out_state5;
</span></span><span style="display:flex;"><span>div_clk #(.DIVISOR(<span style="color:#ff9f43">12</span>)) div_clk_beep1 (.clk_in(clk),.rst(),.clk_out(beep_out_state0));
</span></span><span style="display:flex;"><span>div_clk #(.DIVISOR(<span style="color:#ff9f43">10</span>)) div_clk_beep2 (.clk_in(clk),.rst(),.clk_out(beep_out_state1));
</span></span><span style="display:flex;"><span>div_clk #(.DIVISOR(<span style="color:#ff9f43">8</span>)) div_clk_beep3 (.clk_in(clk),.rst(),.clk_out(beep_out_state2));
</span></span><span style="display:flex;"><span>div_clk #(.DIVISOR(<span style="color:#ff9f43">6</span>)) div_clk_beep4 (.clk_in(clk),.rst(),.clk_out(beep_out_state3));
</span></span><span style="display:flex;"><span>div_clk #(.DIVISOR(<span style="color:#ff9f43">4</span>)) div_clk_beep5 (.clk_in(clk),.rst(),.clk_out(beep_out_state4));
</span></span><span style="display:flex;"><span>div_clk #(.DIVISOR(<span style="color:#ff9f43">2</span>)) div_clk_beep6 (.clk_in(clk),.rst(),.clk_out(beep_out_state5));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">assign</span> beep_out <span style="color:#ff6ac1">=</span> <span style="color:#ff6ac1">!</span>beep_en <span style="color:#ff6ac1">?</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span> <span style="color:#ff6ac1">:</span> state <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b000</span>) <span style="color:#ff6ac1">?</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span> <span style="color:#ff6ac1">:</span>
</span></span><span style="display:flex;"><span>                  (state <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b001</span>) <span style="color:#ff6ac1">?</span> beep_out_state0 <span style="color:#ff6ac1">:</span>
</span></span><span style="display:flex;"><span>                  (state <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b010</span>) <span style="color:#ff6ac1">?</span> beep_out_state1 <span style="color:#ff6ac1">:</span>
</span></span><span style="display:flex;"><span>                  (state <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b011</span>) <span style="color:#ff6ac1">?</span> beep_out_state2 <span style="color:#ff6ac1">:</span>
</span></span><span style="display:flex;"><span>                  (state <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b100</span>) <span style="color:#ff6ac1">?</span> beep_out_state3 <span style="color:#ff6ac1">:</span>
</span></span><span style="display:flex;"><span>                  (state <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b101</span>) <span style="color:#ff6ac1">?</span> beep_out_state4 <span style="color:#ff6ac1">:</span>
</span></span><span style="display:flex;"><span>                  (state <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b110</span>) <span style="color:#ff6ac1">?</span> beep_out_state5 <span style="color:#ff6ac1">:</span>
</span></span><span style="display:flex;"><span>                  (state <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">3</span><span style="color:#ff9f43">&#39;b111</span>) <span style="color:#ff6ac1">?</span> beep_out_state5 <span style="color:#ff6ac1">:</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span>
</span></span></code></pre></div><h3 id="debouncev"><code>debounce.v</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#78787e">// debounce.v
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span><span style="color:#ff6ac1">module</span> debounce(
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> clk,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> rst,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">input</span> key,
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">output</span> <span style="color:#9aedfe">reg</span> key_pulse
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> [<span style="color:#ff9f43">3</span><span style="color:#ff6ac1">:</span><span style="color:#ff9f43">0</span>] cnt;
</span></span><span style="display:flex;"><span>    <span style="color:#9aedfe">reg</span> flag ;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">initial</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>    cnt <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0000</span>;
</span></span><span style="display:flex;"><span>    key_pulse <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span>    flag <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">always</span> @(<span style="color:#ff6ac1">posedge</span> clk) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">if</span> (rst) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        cnt <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0000</span>;
</span></span><span style="display:flex;"><span>        key_pulse <span style="color:#ff6ac1">&lt;=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span>        flag <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">if</span> (key) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">if</span> (cnt <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span> <span style="color:#ff6ac1">&amp;&amp;</span> flag <span style="color:#ff6ac1">==</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span> ) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#78787e">// 计数器数到16并且这16个周期内状态无变化则表示按键按下去了
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>            key_pulse <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;
</span></span><span style="display:flex;"><span>            flag <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;
</span></span><span style="display:flex;"><span>            cnt <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0000</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">if</span> (cnt <span style="color:#ff6ac1">!=</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b1111</span>) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            cnt <span style="color:#ff6ac1">=</span> cnt <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">4</span><span style="color:#ff9f43">&#39;b0001</span>;
</span></span><span style="display:flex;"><span>            key_pulse <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>            key_pulse <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b0</span>;
</span></span><span style="display:flex;"><span>            flag <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">1</span><span style="color:#ff9f43">&#39;b1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span> <span style="color:#ff6ac1">else</span> <span style="color:#ff6ac1">if</span> (<span style="color:#ff6ac1">!</span>key) <span style="color:#ff6ac1">begin</span>
</span></span><span style="display:flex;"><span>        flag <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">endmodule</span>
</span></span></code></pre></div><h2 id="仿真波形及波形分析">仿真波形及波形分析</h2>
<h3 id="beepv仿真波形"><code>beep.v</code> 仿真波形</h3>
<p><img src="assets/0829785101a902b043ada44d50b973aa08fe812d.png" alt="1.png"></p>
<p>不难看出，随着状态码的变化，<code>beep_out</code>的频率也随之发生变化，<code>beep_en</code>起到了使能的作用。</p>
<h3 id="key_inputv仿真波形"><code>key_input.v</code>仿真波形</h3>
<p><img src="assets/9dcbe5fa860f2103b4d88369b5670430ca1a31e4.png" alt="2.png"></p>
<p>当连续60次扫描到按键按下时，就会产生一个脉冲信号。</p>
<h3 id="led_matrixv仿真波形"><code>led_matrix.v</code> 仿真波形</h3>
<p><img src="assets/14d989ece4c0ac0bf2878ad8a69144a2c360d0d4.png" alt="3.png"></p>
<p>在前期，状态控制码较小时，此时绿灯红灯亮灭情况如上，黄灯即是红灯和绿灯均亮的时刻，注意到在黄灯及以上状态时<code>beeper</code>使能信号正常工作。</p>
<p><img src="assets/5b973ff562326002f5d2afcbf29b27977e94212e.png" alt="4.png"></p>
<p>在水位超出警戒线后，按下<code>btn7</code>则屏幕开始显示抽水动画。</p>
<p><img src="assets/f75eb0604351d2f2900226d8fae95a2170b2e263.png" alt="5.png"></p>
<p>在<code>指定</code>的肉眼可分辨频率下进行图像的切换。</p>
<p>总体仿真因时间过长在此不再进行，具体情况可以烧录进开发版后自行测试。</p>
<h2 id="功能说明及资源利用情况">功能说明及资源利用情况</h2>
<h3 id="实现的功能">实现的功能</h3>
<ul>
<li>
<p>通过<code>SW4~SW0</code>的值来确定当前水位，其中<code>SW4~SW1</code>表示整数位，<code>SW0</code>表示小数位，<code>0~6</code>米（含）为安全水位，<code>6~12</code>米（含）为警惕水位，<code>12</code>米以上为危险水位。</p>
</li>
<li>
<p>通过<code>4x4</code>键盘输入水位值。</p>
</li>
<li>
<p>用点阵显示水位变化示意图：当水位低于等于<code>6</code>米时，点阵最下面<code>2</code>行显示全绿；当水位在“警惕水位”时，点阵显示黄色，<code>6~8</code>米（含）时，亮下面<code>3</code>行，<code>8~10</code>米（含）时，亮下面<code>4</code>行，<code>10~12</code>米（含）时，亮下面<code>5</code>行；当水位在“危险水位”，点阵显示红色，<code>12~13</code>米（含）时，亮下面<code>6</code>行，<code>13~14</code>米（含）时，亮下面<code>7</code>行，<code>14</code>米以上时，点阵全亮，且以<code>2Hz</code>的频率闪烁。</p>
</li>
<li>
<p>水位处于“警惕水位”或“危险水位”时，蜂鸣器发出报警声，报警声音的音调随水位增高而增高。</p>
</li>
<li>
<p>水位处于“危险水位”时，按<code>BTN0</code>启动点阵动画模拟水泵抽水，抽水动画自行设计，直至水位降至“安全水位”，点阵恢复显示水位变化。</p>
</li>
<li>
<p>水泵抽水速度“慢”、“中”、“快”三档可调，在数码管<code>DISP7</code>上分别显示<code>1</code>、<code>2</code>、<code>3</code>表示三种速度，通过<code>BTN7</code>按键进行循环切换，不同速度时抽水动画的变化速度也同步进行变化。</p>
</li>
</ul>
<h3 id="资源利用情况">资源利用情况</h3>
<h3 id="编译结果">编译结果</h3>
<p><img src="assets/7a6e2e575e721e9436e69f8e48d7a0aea4f97557.png" alt="微信截图_20241214041343.png"></p>
<p>可以看到，源代码顺利通过编译。</p>
<h3 id="资源利用情况-1">资源利用情况</h3>
<p><img src="assets/123.png" alt="2.png"></p>
<p>可以看到，总共有<code>504</code>个逻辑元件。</p>
<h2 id="故障及问题分析">故障及问题分析</h2>
<h3 id="1-按键输入故障">1. 按键输入故障</h3>
<ul>
<li><strong>问题描述</strong>：按键可能因为硬件损坏或软件消抖处理不当导致输入错误。</li>
<li><strong>分析</strong>：检查<code>key_input.v</code>和<code>debounce.v</code>模块，确保消抖逻辑正确实现，以及硬件按键是否物理损坏。</li>
</ul>
<h3 id="2-数码管显示错误">2. 数码管显示错误</h3>
<ul>
<li><strong>问题描述</strong>：数码管可能因为译码错误或选位信号不正确而显示错误。</li>
<li><strong>分析</strong>：检查<code>segment7.v</code>和<code>select_disp.v</code>模块，确保数码管译码和选位信号生成正确。</li>
</ul>
<h3 id="4-水位监测逻辑错误">4. 水位监测逻辑错误</h3>
<ul>
<li><strong>问题描述</strong>：水位监测逻辑可能因为状态判断错误导致报警或水泵控制不当。</li>
<li><strong>分析</strong>：检查<code>controller.v</code>模块，确保水位状态判断和水泵控制逻辑正确。</li>
</ul>
<h3 id="7-资源利用不足或浪费">7. 资源利用不足或浪费</h3>
<ul>
<li><strong>问题描述</strong>：资源利用不足可能导致功能无法实现，资源浪费可能导致成本增加。</li>
<li><strong>分析</strong>：根据资源利用情况，优化设计，减少不必要的资源占用。</li>
</ul>
<h2 id="总结和结论">总结和结论</h2>
<p>本设计成功实现了一个水位监测系统，通过控制点阵、数码管等显示水位信息，并在水位超出范围时进行报警。系统功能包括水位监测、水泵抽水模拟、报警声控制等，满足了基本和提高要求。</p>
<p>通过仿真波形和资源利用情况分析，系统各模块功能正常，资源利用合理。仿真波形验证了各模块的正确性，资源利用情况显示系统在资源限制内实现了所需功能。</p>
<p>后续工作包括在实际硬件上测试系统，优化设计以减少资源占用，以及根据测试结果进行故障排查和系统优化。通过这些工作，可以进一步提高系统的稳定性和可靠性。</p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">最后修改于 2024-12-21</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/2025%E6%96%B0%E5%B9%B4%E5%A5%BD/">
			下回<br>25年春节小记
                </a>
                
                
                
                <a class="older-posts" href="/posts/luogu_%E6%96%B9%E5%9D%97%E8%BD%AC%E6%8D%A2/">
			上回<br>方块转换
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://www.zhaocloud.work/">
    
        <div class="nav-title">
            April Diary
        </div>
        
        <div class="nav-subtitle">
            人间四月芳菲尽
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                时间线
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                归档
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                标签
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	April. 本站遵循 CC-BY-NC 4.0 协议
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%95%b0%e5%ad%97%e7%b3%bb%e7%bb%9f%e8%ae%be%e8%ae%a1%e5%ae%9e%e9%aa%8c%e6%8a%a5%e5%91%8a%e6%b0%b4%e4%bd%8d%e7%9b%91%e6%b5%8b" class="nav-数字系统设计实验报告水位监测">
									数字系统设计实验报告——水位监测
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%ae%be%e8%ae%a1%e8%af%be%e9%a2%98%e7%9a%84%e4%bb%bb%e5%8a%a1%e8%a6%81%e6%b1%82" class="nav-设计课题的任务要求">
									设计课题的任务要求
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9f%ba%e6%9c%ac%e8%a6%81%e6%b1%82" class="nav-基本要求">
									基本要求
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%8f%90%e9%ab%98%e8%a6%81%e6%b1%82" class="nav-提高要求">
									提高要求
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a8%a1%e5%9d%97%e7%94%b5%e8%b7%af%e8%a6%81%e6%b1%82" class="nav-模块电路要求">
									模块电路要求
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%b3%bb%e7%bb%9f%e8%ae%be%e8%ae%a1" class="nav-系统设计">
									系统设计
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%ae%be%e8%ae%a1%e6%80%9d%e8%b7%af" class="nav-设计思路">
									设计思路
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%80%bb%e4%bd%93%e6%a1%86%e5%9b%be" class="nav-总体框图">
									总体框图
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e5%9d%97%e8%ae%be%e8%ae%a1" class="nav-分块设计">
									分块设计
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#verilog-hdl-%e4%bb%a3%e7%a0%81" class="nav-verilog-hdl-代码">
									Verilog HDL 代码
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#water_detectionv" class="nav-water_detectionv">
									water_detection.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#key_inputv" class="nav-key_inputv">
									key_input.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#kv_mapv" class="nav-kv_mapv">
									kv_map.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#div_clkv" class="nav-div_clkv">
									div_clk.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#select_dispv" class="nav-select_dispv">
									select_disp.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#segment7v" class="nav-segment7v">
									segment7.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#led_dispv" class="nav-led_dispv">
									led_disp.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#digi_screenv" class="nav-digi_screenv">
									digi_screen.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#led_matrixv" class="nav-led_matrixv">
									led_matrix.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#controllerv" class="nav-controllerv">
									controller.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#beepv" class="nav-beepv">
									beep.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#debouncev" class="nav-debouncev">
									debounce.v
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e4%bb%bf%e7%9c%9f%e6%b3%a2%e5%bd%a2%e5%8f%8a%e6%b3%a2%e5%bd%a2%e5%88%86%e6%9e%90" class="nav-仿真波形及波形分析">
									仿真波形及波形分析
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#beepv%e4%bb%bf%e7%9c%9f%e6%b3%a2%e5%bd%a2" class="nav-beepv仿真波形">
									beep.v 仿真波形
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#key_inputv%e4%bb%bf%e7%9c%9f%e6%b3%a2%e5%bd%a2" class="nav-key_inputv仿真波形">
									key_input.v仿真波形
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#led_matrixv%e4%bb%bf%e7%9c%9f%e6%b3%a2%e5%bd%a2" class="nav-led_matrixv仿真波形">
									led_matrix.v 仿真波形
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%8a%9f%e8%83%bd%e8%af%b4%e6%98%8e%e5%8f%8a%e8%b5%84%e6%ba%90%e5%88%a9%e7%94%a8%e6%83%85%e5%86%b5" class="nav-功能说明及资源利用情况">
									功能说明及资源利用情况
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%9e%e7%8e%b0%e7%9a%84%e5%8a%9f%e8%83%bd" class="nav-实现的功能">
									实现的功能
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%b5%84%e6%ba%90%e5%88%a9%e7%94%a8%e6%83%85%e5%86%b5" class="nav-资源利用情况">
									资源利用情况
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bc%96%e8%af%91%e7%bb%93%e6%9e%9c" class="nav-编译结果">
									编译结果
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%b5%84%e6%ba%90%e5%88%a9%e7%94%a8%e6%83%85%e5%86%b5-1" class="nav-资源利用情况-1">
									资源利用情况
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%95%85%e9%9a%9c%e5%8f%8a%e9%97%ae%e9%a2%98%e5%88%86%e6%9e%90" class="nav-故障及问题分析">
									故障及问题分析
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#1-%e6%8c%89%e9%94%ae%e8%be%93%e5%85%a5%e6%95%85%e9%9a%9c" class="nav-1-按键输入故障">
									1. 按键输入故障
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2-%e6%95%b0%e7%a0%81%e7%ae%a1%e6%98%be%e7%a4%ba%e9%94%99%e8%af%af" class="nav-2-数码管显示错误">
									2. 数码管显示错误
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#4-%e6%b0%b4%e4%bd%8d%e7%9b%91%e6%b5%8b%e9%80%bb%e8%be%91%e9%94%99%e8%af%af" class="nav-4-水位监测逻辑错误">
									4. 水位监测逻辑错误
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#7-%e8%b5%84%e6%ba%90%e5%88%a9%e7%94%a8%e4%b8%8d%e8%b6%b3%e6%88%96%e6%b5%aa%e8%b4%b9" class="nav-7-资源利用不足或浪费">
									7. 资源利用不足或浪费
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%80%bb%e7%bb%93%e5%92%8c%e7%bb%93%e8%ae%ba" class="nav-总结和结论">
									总结和结论
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>

<div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	April. 本站遵循 CC-BY-NC 4.0 协议
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
