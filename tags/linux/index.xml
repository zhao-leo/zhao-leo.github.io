<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Linux on April Diary</title>
    <link>https://www.zhaocloud.work/tags/linux/</link>
    <description>Recent content in Linux on April Diary</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <copyright>April. 本站遵循 CC-BY-NC 4.0 协议</copyright>
    <lastBuildDate>Sat, 01 Mar 2025 00:47:40 +0800</lastBuildDate>
    <atom:link href="https://www.zhaocloud.work/tags/linux/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>树莓派上编译libtorch</title>
      <link>https://www.zhaocloud.work/posts/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8A%E7%BC%96%E8%AF%91libtorch/</link>
      <pubDate>Sat, 01 Mar 2025 00:47:40 +0800</pubDate>
      <guid>https://www.zhaocloud.work/posts/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8A%E7%BC%96%E8%AF%91libtorch/</guid>
      <description>&lt;h1 id=&#34;树莓派上编译libtorch&#34;&gt;树莓派上编译libtorch&lt;/h1&gt;&#xA;&lt;p&gt;首先，官网上的肯定是不能正常使用的，官网的&lt;code&gt;libtorch&lt;/code&gt;仅在&lt;code&gt;x86_64&lt;/code&gt;的机器上编译，当下载到&lt;code&gt;ARM&lt;/code&gt;架构的树莓派时就无法正常工作了，为此，我和同学进行了多次编译，最终将经验教训总结如下。&lt;/p&gt;&#xA;&lt;h2 id=&#34;libtorch的版本选择&#34;&gt;libtorch的版本选择&lt;/h2&gt;&#xA;&lt;p&gt;如果你使用了v2.6.0在树莓派上编译，你会遇到&lt;code&gt;Illegal instruction (core dumped)&lt;/code&gt;，这一步真的是非常坑。&lt;/p&gt;&#xA;&lt;p&gt;我们在不同的&lt;code&gt;ARM&lt;/code&gt;机器上编译了很多次，但是只要放到&lt;code&gt;Raspberry Pi 4&lt;/code&gt;上就必定出现这个报错。&lt;/p&gt;&#xA;&lt;p&gt;究其原因，在看了&lt;code&gt;pytorch&lt;/code&gt;仓库的issue&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;之后，我们发现，是&lt;code&gt;libtorchv2.6.0&lt;/code&gt;本身存在BUG，无法在&lt;code&gt;Raspberry Pi 4&lt;/code&gt;上运行。&lt;/p&gt;&#xA;&lt;p&gt;因此，比较合理的选择是切换到已经验证的&lt;code&gt;v2.5.1&lt;/code&gt;版本，所以以下工作是在&lt;code&gt;v2.5.1&lt;/code&gt;的情况下实现的。&lt;/p&gt;&#xA;&lt;h2 id=&#34;构建libtorch前的必要准备&#34;&gt;构建libtorch前的必要准备&lt;/h2&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;确认你已经阅读过了构建文档&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;你已经&lt;code&gt;pull&lt;/code&gt;了&lt;code&gt;pytorch&lt;/code&gt;的官方仓库，分支切换到了&lt;code&gt;v2.5.1&lt;/code&gt;，下载了所有的第三方包&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;有一台树莓派4并执行命令如下：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt update&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install gcc cmake clang openssh-server curl&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 id=&#34;构建libtorch&#34;&gt;构建libtorch&lt;/h2&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;建议使用&lt;code&gt;Cmake&lt;/code&gt;构建&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;h3 id=&#34;在pytorch同级目录创建构建文件夹&#34;&gt;在pytorch同级目录创建构建文件夹&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir pytorch-build &lt;span style=&#34;color:#ff6ac1&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;cd&lt;/span&gt; pytorch-build&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;执行cmake指令&#34;&gt;执行Cmake指令&lt;/h3&gt;&#xA;&lt;p&gt;相关环境变量设置的来源：&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;DCAFFE2_CPU_FLAGS=&amp;quot;-mfpu=neon -mfloat-abi=hard&amp;quot;&lt;/code&gt;&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;&#xA;&lt;p&gt;其他环境变量&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;总指令&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cmake &lt;span style=&#34;color:#5af78e&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&lt;/span&gt;  -DCMAKE_BUILD_TYPE&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;Release &lt;span style=&#34;color:#5af78e&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&lt;/span&gt;  -DCMAKE_INSTALL_PREFIX&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;../pytorch-install &lt;span style=&#34;color:#5af78e&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&lt;/span&gt;  -DPYTHON_EXECUTABLE&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;$(&lt;/span&gt;which python3&lt;span style=&#34;color:#ff6ac1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&lt;/span&gt;  -DBUILD_SHARED_LIBS&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;ON &lt;span style=&#34;color:#5af78e&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&lt;/span&gt;  -DCAFFE2_CPU_FLAGS&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;-mfpu=neon -mfloat-abi=hard&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&lt;/span&gt;  -USE_CUDA&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&lt;/span&gt;  -USE_CUDNN&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&lt;/span&gt;  -USE_MLKDNN&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&lt;/span&gt;  -USE_DISTRIBUTED&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&lt;/span&gt;  -DCFLAGS&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;-march=armv8-a+crc -mtune=cortex-a72&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&lt;/span&gt; ../pytorch &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;启动构建&#34;&gt;启动构建&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cmake --build . --target install -j &lt;span style=&#34;color:#ff9f43&#34;&gt;2&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;不出意外，你能在&lt;code&gt;pytorch&lt;/code&gt;同级文件夹找到&lt;code&gt;pytorch-install&lt;/code&gt;文件夹，这就是需要的&lt;code&gt;libtorch&lt;/code&gt;库。&lt;/p&gt;</description>
    </item>
    <item>
      <title>Cloudstudio配置</title>
      <link>https://www.zhaocloud.work/posts/cloudstudio%E9%85%8D%E7%BD%AE/</link>
      <pubDate>Sun, 26 Jan 2025 15:51:32 +0800</pubDate>
      <guid>https://www.zhaocloud.work/posts/cloudstudio%E9%85%8D%E7%BD%AE/</guid>
      <description>&lt;h1 id=&#34;在腾讯cloudstudio上训练yolo模型的环境配置问题&#34;&gt;在腾讯CloudStudio上训练yolo模型的环境配置问题&lt;/h1&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;众所周知：配环境是成为程序员最难的一步。&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;在&lt;code&gt;cloud studio&lt;/code&gt;运行&lt;code&gt;yolov8&lt;/code&gt;时遇到了几个问题，顺手记录在这。&lt;/p&gt;&#xA;&lt;p&gt;&lt;small&gt;主要是可以白嫖大显存GPU，本蒟蒻只有可怜兮兮的3050Laptop-4G  o(╥﹏╥)o&lt;/small&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;第一个问题&#34;&gt;第一个问题&lt;/h2&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ImportError: libGL.so.1: cannot open shared object file: No such file or directory&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;解决方案也比较简单：&lt;/p&gt;&#xA;&lt;p&gt;来源：&lt;a href=&#34;https://stackoverflow.com/questions/55313610/importerror-libgl-so-1-cannot-open-shared-object-file-no-such-file-or-directo&#34;&gt;&lt;code&gt;Stackoverflow&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;一行命令就解决了……&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apt install libgl1-mesa-glx&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;第二个问题&#34;&gt;第二个问题&lt;/h2&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ImportError: /lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.29&amp;#39; not found (required by /root/miniforge3/lib/python3.10/site-packages/matplotlib/_c_internal_utils.cpython-310-x86_64-linux-gnu.so)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我先使用了同样来自&lt;code&gt;Stackoverflow&lt;/code&gt;的解答：&lt;a href=&#34;https://stackoverflow.com/questions/65349875/where-can-i-find-glibcxx-3-4-29&#34;&gt;点击前往&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;也就是如下的方案：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo add-apt-repository ppa:ubuntu-toolchain-r/test # Ignore if not ubuntu&#xA;sudo apt-get update&#xA;sudo apt-get install gcc-4.9&#xA;sudo apt-get upgrade libstdc++6&#xA;sudo apt-get dist-upgrade&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;但是非常遗憾，没有效果，还是出现了报错……&lt;/p&gt;&#xA;&lt;p&gt;这时候，我非常不情愿的打开了&lt;code&gt;csdn&lt;/code&gt;，但是非常幸运，我找到了&lt;a href=&#34;https://blog.csdn.net/weixin_39379635/article/details/129159713&#34;&gt;解决方案&lt;/a&gt;。&lt;/p&gt;&#xA;&lt;p&gt;以我浅薄的理解，应该是&lt;code&gt;linux&lt;/code&gt;中有合适的版本，但是&lt;code&gt;/usr/lib/x86_64-linux-gnu/&lt;/code&gt;路径下的&lt;code&gt;libstdc++&lt;/code&gt;默认的依赖是一个比较老的，因此你安装了新的版本也无济于事，因为这个依赖不会自动更改。&lt;/p&gt;&#xA;&lt;p&gt;知道问题是解决问题的开始：&#xA;首先找个高版本的库：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo find / -name &amp;#34;libstdc++.so.6*&amp;#34;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;一个可能的版本：&lt;code&gt;6.0.29&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;然后我们查看这个包是否有&lt;code&gt;GLIBCXX_3.4.29&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;strings /.../lib/libstdc++.so.6.0.29 | grep GLIBCXX&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果有，你应该在控制台输出中找到如下的字符：&lt;code&gt;GLIBCXX_3.4.29&lt;/code&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
